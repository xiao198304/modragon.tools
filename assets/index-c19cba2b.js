import{bG as A,bU as z,bV as I,bR as J,bW as D,bl as Q,bn as T,bo as x,bp as p,bA as N,bu as t,bq as V,bC as M,bX as X,br as S,bs as g,bw as b,bY as K,bZ as ee,b_ as te,b$ as ae,c0 as Z,c1 as se,c2 as ne,bx as R,bt as o,bz as G,by as P,bv as _,c3 as le,bF as oe,bH as re}from"./index-efe2ad3b.js";async function W(c){let d=[],s=c[0].blockNumber,u=(await A.getBlock(s)).timestamp,v=c[c.length-1].blockNumber,y=(await A.getBlock(v)).timestamp,r=0;v>s&&(r=(y-u)/(v-s)),c.forEach(function(e){e.timestamp=u+(e.blockNumber-s)*r});for(let e=0;e<c.length;e++){let i=c[e],O="0x"+i.topics[1].substr(-40),k=parseInt(i.data.slice(2,66),16),E=parseInt(i.data.slice(66,130),16),j=parseInt(i.data.slice(130,194),16),H=parseInt(i.data.slice(-64),16),Y=await z.getDragonByTokenId(k),q=await z.getDragonByTokenId(E),F=await z.getDragonByTokenId(j),m=Y.map(l=>parseInt(l)),n=q.map(l=>parseInt(l)),w=F.map(l=>parseInt(l)),B=I[1],h=I[1],C=I[1];for(let l in I)l==m[0]&&(B=I[l]),l==n[0]&&(h=I[l]),l==w[0]&&(C=I[l]);let L=0,f=0,U=J().unix(),a=(H-J().unix())*1e3;H>=U&&(L=1,f=2);let $={owner:O,timestamp:i.timestamp,blockNumber:i.blockNumber,transactionHash:i.transactionHash,token0:{id:k,level:D(m[2]).length,elements:D(m[2]),name:B.cnName,state:L,attrs:m,diffTimeStamp:a,hatch_id:0},token1:{id:E,level:D(n[2]).length,elements:D(n[2]),name:h.cnName,state:L,attrs:n,diffTimeStamp:a,hatch_id:0},eggToken:{id:j,level:D(w[2]).length,elements:D(w[2]),name:C.cnName,state:f,attrs:w,diffTimeStamp:a,hatch_id:0}};d.push($)}return d}const ce={key:1,class:"text-sm text-gray-500 text-right mr-5"},ie={class:"m-5 text-center"},de=Q({__name:"DataCell",props:{title:{type:String,default:""},listLength:{type:Number,default:0},isinset:{type:Boolean,default:!0}},emits:["changeCount"],setup(c,{emit:d}){const s=c,u=T(5),v=r=>{u.value+=r,d("changeCount",u)},y=()=>{u.value=5,d("changeCount",u)};return(r,e)=>{const i=x("van-cell"),O=x("van-cell-group");return p(),N(O,{inset:s.isinset,class:"mt-5"},{default:t(()=>[s.title!=""?(p(),N(i,{key:0,title:s.title,icon:"label-o"},{value:t(()=>[u.value>5?(p(),V("span",{key:0,onClick:e[0]||(e[0]=k=>y())},"只显示5行")):M("",!0)]),_:1},8,["title"])):(p(),V("div",ce,[u.value>5?(p(),V("span",{key:0,onClick:e[1]||(e[1]=k=>y())},"只显示5行")):M("",!0)])),X(r.$slots,"default"),S("div",ie,[u.value<s.listLength?(p(),V("span",{key:0,class:"text-gray-500",onClick:e[2]||(e[2]=k=>v(5))},"查看更多")):M("",!0)])]),_:3},8,["inset"])}}}),ue={class:"text-sm"},me=Q({__name:"AddressLabel",props:{address:{type:String,default:""}},setup(c){const d=c,s=T(!1),u=[{id:2,text:"Arbiscan.io",code:d.address,icon:"share-o"}],v=y=>{if(y.id==2){let r="https://arbiscan.io/address/"+d.address;window.open(r,"_blank")}};return(y,r)=>{const e=x("van-popover");return p(),N(e,{show:s.value,"onUpdate:show":r[0]||(r[0]=i=>s.value=i),actions:u,onSelect:v,placement:"top-start"},{reference:t(()=>[S("span",ue,g(b(K)(d.address)),1)]),_:1},8,["show"])}}});const pe="https://tools-1258577806.cos.ap-hongkong.myqcloud.com/modragon/breedinfo/last12.zip.json",fe=ee("trend",()=>{const c=T({});async function d(){let s=pe+"?="+J().format("YYYYMMDDHHmm");return c.value=await te(s),c}return{breedinfos:c,initBreedinfos:d}}),_e={style:{width:"90%"},class:"text-left mt-1"},ge=S("span",{class:"text-gray-400 text-sm"},"时间:",-1),be={class:"text-black-500 text-sm ml-1"},ve={style:{width:"90%"},class:"text-left mt-1"},ye=S("span",{class:"text-gray-400 text-sm"},"数量:",-1),he={class:"text-black-500 text-sm ml-1"},ke=Q({__name:"index",setup(c){const d=fe(),{breedinfos:s}=ae(d),{initBreedinfos:u}=d,v=T(""),y=T("");let r=null,e=Z({all:[],last:[]}),i=Z({last:5,luck:5,bad:5});const O=m=>i.last=m,k=T(!1),E=async()=>{await j(!0),le("刷新完成"),k.value=!1};se(async()=>{await j()}),ne(async()=>{A.removeAllListeners(),r&&clearInterval(r)});const j=async(m=!1)=>{oe({duration:0,message:"数据更新"}),A.removeAllListeners(),r&&clearInterval(r),r=setInterval(()=>{v.value=J().format("HH:mm:ss")});let n=[];if(await u(),console.log(s.value.endblock),s.value.data.length>0){let h=JSON.parse(JSON.stringify(s.value.data));n.push(...h),y.value=J.unix(s.value.starttimestamp).format("HH:mm")}console.log("1--- ",n.length),H(n);let w=s.value.endblock+1;const B=await A.getLogs({fromBlock:w,toBlock:"latest",address:"0xc51b8da084b15aaaa13cf04a5efbcf0415169708",topics:["0x32a657ab4b72676031878dbdd8a129e1415f2e05d5fc023328347fa816181cfb",null]});if(B.length>0){let h=await W(B);n.push(...h),console.log("2--- ",n.length),H(n)}re(),A.on({address:"0xc51b8da084b15aaaa13cf04a5efbcf0415169708",topics:["0x32a657ab4b72676031878dbdd8a129e1415f2e05d5fc023328347fa816181cfb",null]},async h=>{console.log("new item");let C=await W([h]);n.push(...C),H(n)})},H=m=>{e.all=[];let n=JSON.parse(JSON.stringify(m));e.all=n.reverse(),F(q.value)};let Y=T([{quality:0,title:"ALL",color:"black",rgb:"#1f1f1f",color_cn:"黑色",name:"全部"}]);Y.value.push(...R);const q=T(0),F=m=>{q.value=m,m>0?e.last=e.all.filter(n=>n.eggToken.level==m):e.last=JSON.parse(JSON.stringify(e.all))};return(m,n)=>{const w=x("van-grid-item"),B=x("van-grid"),h=x("van-cell-group"),C=x("van-tag"),L=x("van-row"),f=x("van-col"),U=x("van-pull-refresh");return p(),N(U,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=a=>k.value=a),onRefresh:E},{default:t(()=>[o(h,{inset:"",class:"mt-2"},{default:t(()=>[o(B,{"column-num":"2"},{default:t(()=>[o(w,{"use-slot":""},{default:t(()=>[S("div",_e,[ge,S("span",be,g(y.value)+"-"+g(v.value),1)])]),_:1}),o(w,{"use-slot":""},{default:t(()=>[S("div",ve,[ye,S("span",he,g(b(e).last.length),1)])]),_:1})]),_:1})]),_:1}),(p(),N(de,{title:"最新孵化记录",listLength:b(e).last.length,onChangeCount:O,key:"last"+b(e).last.length},{default:t(()=>[o(L,{justify:"center",class:"py-2 text-center"},{default:t(()=>[(p(!0),V(P,null,G(b(Y),(a,$)=>(p(),N(C,{key:$,class:"mr-4",color:a.rgb,plain:a.quality!=q.value,onClick:l=>F(a.quality)},{default:t(()=>[_(g(a.name),1)]),_:2},1032,["color","plain","onClick"]))),128))]),_:1}),o(L,{justify:"center",class:"my-2 text-center"},{default:t(()=>[o(f,{span:"4",class:"text-base text-gray-500"},{default:t(()=>[_("时间")]),_:1}),o(f,{span:"6",class:"text-base text-gray-500"},{default:t(()=>[_("账号")]),_:1}),o(f,{span:"4",class:"text-base text-gray-500"},{default:t(()=>[_("父龙")]),_:1}),o(f,{span:"4",class:"text-base text-gray-500"},{default:t(()=>[_("母龙")]),_:1}),o(f,{span:"4",class:"text-base text-gray-500"},{default:t(()=>[_("龙蛋")]),_:1})]),_:1}),(p(!0),V(P,null,G(b(e).last.slice(0,b(i).last),(a,$)=>(p(),N(L,{justify:"center",class:"text-center",style:{"border-top":"thin solid #e5e7eb"},key:"last"+a.blockNumber+a.owner+$*1e3},{default:t(()=>[o(f,{span:"4",class:"py-2 text-sm"},{default:t(()=>[_(g(b(J).unix(a.timestamp).format("HH:mm")),1)]),_:2},1024),o(f,{span:"6",class:"py-2 text-sm"},{default:t(()=>[(p(),N(me,{address:a.owner,key:"last"+a.blockNumber+a.owner+$*1e3},null,8,["address"]))]),_:2},1024),o(f,{span:"4",class:"py-2 text-sm"},{default:t(()=>[o(C,{plain:"",color:b(R).find(l=>l.quality==a.token0.level).rgb},{default:t(()=>[_(g(a.token0.name),1)]),_:2},1032,["color"]),_(" "+g(a.token0.attrs[6]),1)]),_:2},1024),o(f,{span:"4",class:"py-2 text-sm"},{default:t(()=>[o(C,{plain:"",color:b(R).find(l=>l.quality==a.token1.level).rgb},{default:t(()=>[_(g(a.token1.name),1)]),_:2},1032,["color"]),_(" "+g(a.token1.attrs[6]),1)]),_:2},1024),o(f,{span:"4",class:"py-2 text-sm"},{default:t(()=>[o(C,{plain:"",color:b(R).find(l=>l.quality==a.eggToken.level).rgb},{default:t(()=>[_(g(a.eggToken.name),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["listLength"]))]),_:1},8,["modelValue"])}}});export{ke as default};
